# å¿«é€Ÿåƒè€ƒæŒ‡å—ï¼šMarkdown vs JSON è™•ç†

## ğŸ¯ æ ¸å¿ƒçµè«–

### ç•¶å‰å•é¡Œ
- **å•é¡Œæ–‡ä»¶**: `agents/report_agent.py`
- **å•é¡Œè¡Œ**: Line 8, 170-221
- **ç—‡ç‹€**: PDF æ ¼å¼ä¸å®Œæ•´ï¼ŒMarkdown æ¨™è¨˜æ²’æœ‰æ­£ç¢ºæ¸²æŸ“

### æ ¹æœ¬åŸå› 
```python
# âŒ éŒ¯èª¤æ–¹å¼ï¼ˆç•¶å‰ä»£ç¢¼ï¼‰
import markdown  # å°å…¥ä½†å¾æœªä½¿ç”¨ï¼

def _parse_markdown_to_story(self, markdown_content: str):
    lines = markdown_content.split('\n')  # ç°¡å–®åˆ†å‰²
    for line in lines:
        if line.startswith('# '):  # å­—ç¬¦ä¸²åŒ¹é…
            # åªèƒ½è™•ç†æœ€åŸºæœ¬çš„æ ¼å¼
```

## ğŸ“‹ å“ªäº›æ‡‰è©²ç”¨ JSONï¼Ÿ

### âœ… é©åˆ JSON çš„å ´æ™¯

1. **é…ç½®æ•¸æ“š**
   ```python
   # config.json
   {
       "app_name": "æ±å—äºé‡‘èæ–°è",
       "email_settings": {...}
   }
   ```

2. **çµæ§‹åŒ–æ•¸æ“šäº¤æ›**ï¼ˆå¦‚æœéœ€è¦ï¼‰
   ```python
   # ä¾‹å¦‚ï¼šå¦‚æœè¦æ”¹è®Š Agent ä¹‹é–“çš„æ•¸æ“šæ ¼å¼
   {
       "news": [
           {
               "title": "æ–°èæ¨™é¡Œ",
               "content": "å…§å®¹",
               "url": "é€£çµ"
           }
       ]
   }
   ```

3. **API éŸ¿æ‡‰**
   ```python
   # Flask API è¿”å›
   return jsonify({
       "status": "success",
       "data": {...}
   })
   ```

### âŒ ä¸é©åˆ JSON çš„å ´æ™¯

1. **AI ç”Ÿæˆçš„é•·æ–‡æœ¬**
   - åŸå› ï¼šMarkdown æ›´è‡ªç„¶ã€æ›´æ˜“è®€
   - ç•¶å‰æ­£ç¢ºä½¿ç”¨ï¼šAnalyst Agent è¼¸å‡º Markdown

2. **å ±å‘Šçš„æœ€çµ‚å‘ˆç¾**
   - åŸå› ï¼šPDF æ›´å°ˆæ¥­
   - ç•¶å‰æ­£ç¢ºä½¿ç”¨ï¼šReport Agent ç”Ÿæˆ PDF

## ğŸ å“ªäº›æ‡‰è©²ç”¨ Python è™•ç†ï¼Ÿ

### âœ… Python æ‡‰è™•ç†çš„ Markdown ä»»å‹™

**æ–‡ä»¶**: `agents/report_agent.py`

**ä»»å‹™ 1: Markdown â†’ HTML**
```python
import markdown

# âœ… æ­£ç¢ºæ–¹å¼
html_content = markdown.markdown(
    markdown_content,
    extensions=['extra', 'nl2br', 'sane_lists']
)
```

**ä»»å‹™ 2: HTML â†’ ReportLab å…ƒç´ **
```python
from bs4 import BeautifulSoup

# âœ… è§£æ HTML
soup = BeautifulSoup(html_content, 'html.parser')

# âœ… è½‰æ›ç‚º PDF å…ƒç´ 
for element in soup.descendants:
    if isinstance(element, NavigableString):
        continue
    
    if element.name == 'h1':
        story.append(Paragraph(element.text, styles['CustomTitle']))
    elif element.name == 'h2':
        story.append(Paragraph(element.text, styles['CustomHeading2']))
    elif element.name == 'p':
        # è™•ç†å…§è¯æ ¼å¼ (ç²—é«”ã€æ–œé«”ã€é€£çµ)
        formatted_text = self._process_inline_elements(element)
        story.append(Paragraph(formatted_text, styles['CustomBody']))
```

**ä»»å‹™ 3: ä¸­æ–‡å­—é«”è™•ç†**
```python
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont

# âœ… è¨»å†Šä¸­æ–‡å­—é«”
font_paths = [
    'C:\\Windows\\Fonts\\msjh.ttc',  # å¾®è»Ÿæ­£é»‘é«”
    'C:\\Windows\\Fonts\\msyh.ttc',  # å¾®è»Ÿé›…é»‘
]

for font_path in font_paths:
    if Path(font_path).exists():
        pdfmetrics.registerFont(TTFont('ChineseFont', font_path))
        break
```

## ğŸ”§ éœ€è¦ä¿®æ”¹çš„å…·é«”ä½ç½®

### æ–‡ä»¶: `agents/report_agent.py`

#### ä½ç½® 1: å°å…¥èªå¥ (Line 1-19)
```python
# âœ… æ·»åŠ 
from bs4 import BeautifulSoup
from html.parser import HTMLParser
```

#### ä½ç½® 2: `_parse_markdown_to_story` æ–¹æ³• (Line 170-221)

**æ›¿æ›æ•´å€‹æ–¹æ³•ç‚º**:
```python
def _parse_markdown_to_story(self, markdown_content: str):
    """å°‡ Markdown å…§å®¹è½‰æ›ç‚º ReportLab Storyï¼ˆæ”¹é€²ç‰ˆï¼‰"""
    # Step 1: Markdown â†’ HTML
    html_content = markdown.markdown(
        markdown_content,
        extensions=['extra', 'nl2br', 'sane_lists']
    )
    
    # Step 2: HTML â†’ ReportLab å…ƒç´ 
    story = []
    soup = BeautifulSoup(html_content, 'html.parser')
    
    for element in soup.children:
        if element.name == 'h1':
            story.append(Paragraph(element.text, self.styles['CustomTitle']))
            story.append(Spacer(1, 0.3*inch))
        
        elif element.name == 'h2':
            story.append(Paragraph(element.text, self.styles['CustomHeading2']))
            story.append(Spacer(1, 0.2*inch))
        
        elif element.name == 'h3':
            story.append(Paragraph(element.text, self.styles['CustomHeading3']))
            story.append(Spacer(1, 0.1*inch))
        
        elif element.name == 'p':
            # è™•ç†æ®µè½å…§çš„æ ¼å¼
            text = self._process_paragraph(element)
            story.append(Paragraph(text, self.styles['CustomBody']))
            story.append(Spacer(1, 0.1*inch))
        
        elif element.name == 'ul':
            # è™•ç†ç„¡åºåˆ—è¡¨
            for li in element.find_all('li'):
                text = 'â€¢ ' + self._process_paragraph(li)
                story.append(Paragraph(text, self.styles['CustomBody']))
        
        elif element.name == 'hr':
            story.append(Spacer(1, 0.2*inch))
            story.append(Paragraph('_' * 80, self.styles['CustomBody']))
            story.append(Spacer(1, 0.2*inch))
    
    return story

def _process_paragraph(self, element):
    """è™•ç†æ®µè½å…§çš„å…§è¯å…ƒç´ ï¼ˆç²—é«”ã€æ–œé«”ã€é€£çµï¼‰"""
    text = ""
    for child in element.children:
        if isinstance(child, str):
            text += child
        elif child.name == 'strong' or child.name == 'b':
            text += f'<b>{child.text}</b>'
        elif child.name == 'em' or child.name == 'i':
            text += f'<i>{child.text}</i>'
        elif child.name == 'a':
            href = child.get('href', '')
            text += f'{child.text} (<font color="blue">{href}</font>)'
    return text
```

## ğŸ“Š å°æ¯”è¡¨

| é …ç›® | ç•¶å‰æ–¹å¼ | æ­£ç¢ºæ–¹å¼ | æ–‡ä»¶ä½ç½® |
|------|---------|---------|---------|
| **Research Agent** | è¿”å› Markdown âœ… | ä¿æŒä¸è®Š | `agents/research_agent.py` |
| **Analyst Agent** | è¼¸å‡º Markdown âœ… | ä¿æŒä¸è®Š | `agents/analyst_agent.py` |
| **Report Agent** | å­—ç¬¦ä¸²åŒ¹é… âŒ | markdown åº« âœ… | `agents/report_agent.py` |
| **æ•¸æ“šæ ¼å¼** | Dict + Markdown âœ… | ä¿æŒä¸è®Š | æ‰€æœ‰æ–‡ä»¶ |

## ğŸš€ å¯¦æ–½æ­¥é©Ÿ

### ç¬¬ 1 æ­¥ï¼šå®‰è£ä¾è³´
```bash
pip install beautifulsoup4
```

### ç¬¬ 2 æ­¥ï¼šä¿®æ”¹ report_agent.py
1. æ·»åŠ  BeautifulSoup å°å…¥
2. é‡å¯« `_parse_markdown_to_story` æ–¹æ³•
3. æ·»åŠ  `_process_paragraph` è¼”åŠ©æ–¹æ³•

### ç¬¬ 3 æ­¥ï¼šæ¸¬è©¦
```bash
python agents/report_agent.py
```

## âš ï¸ å¸¸è¦‹èª¤å€

### èª¤å€ 1: "æ‡‰è©²æŠŠæ‰€æœ‰æ•¸æ“šæ”¹æˆ JSON"
âŒ **éŒ¯èª¤**: é€™æœƒå¤±å» AI ç”Ÿæˆè‡ªç„¶èªè¨€çš„å„ªå‹¢  
âœ… **æ­£ç¢º**: ä¿æŒ Markdown ä½œç‚ºä¸­é–“æ ¼å¼ï¼Œåªæ”¹é€²è§£ææ–¹å¼

### èª¤å€ 2: "markdown åº«æ²’ç”¨ï¼Œæ‡‰è©²åˆªé™¤"
âŒ **éŒ¯èª¤**: é€™å€‹åº«å¾ˆæœ‰ç”¨ï¼Œåªæ˜¯æ²’è¢«æ­£ç¢ºä½¿ç”¨  
âœ… **æ­£ç¢º**: æ‡‰è©²æ­£ç¢ºä½¿ç”¨é€™å€‹åº«ä¾†è§£æ Markdown

### èª¤å€ 3: "å­—ç¬¦ä¸²åŒ¹é…å°±å¤ äº†"
âŒ **éŒ¯èª¤**: ç„¡æ³•è™•ç†è¤‡é›œæ ¼å¼ï¼ˆç²—é«”ã€æ–œé«”ã€é€£çµç­‰ï¼‰  
âœ… **æ­£ç¢º**: ä½¿ç”¨å°ˆæ¥­çš„ Markdown è§£æå™¨

## ğŸ’¡ ç‚ºä»€éº¼ä¸å…¨éƒ¨ç”¨ JSONï¼Ÿ

### AI Agent ç”Ÿæˆ Markdown çš„å„ªå‹¢
1. **è‡ªç„¶èªè¨€**: AI æ›´æ“…é•·ç”Ÿæˆæµæš¢çš„æ–‡å­—
2. **éˆæ´»æ€§**: Markdown å¯ä»¥è¡¨é”è±å¯Œçš„æ ¼å¼
3. **å¯è®€æ€§**: äººé¡å¯ä»¥ç›´æ¥é–±è®€å’Œç·¨è¼¯

### JSON çš„å±€é™æ€§
1. **çµæ§‹åƒµåŒ–**: éœ€è¦é å®šç¾©æ‰€æœ‰å­—æ®µ
2. **ä¸é©åˆé•·æ–‡æœ¬**: å¤šæ®µè½ã€å¤šæ ¼å¼çš„å…§å®¹åœ¨ JSON ä¸­é›£ä»¥è¡¨ç¤º
3. **AI ç”Ÿæˆå›°é›£**: AI å¯èƒ½ç”Ÿæˆæ ¼å¼ä¸æ­£ç¢ºçš„ JSON

## ğŸ“ ç¸½çµ

### ç•¶å‰ç‹€æ…‹
```
Research â†’ Markdown â†’ Analyst â†’ Markdown â†’ Report (âŒ ç°¡å–®è§£æ) â†’ PDF
```

### æ”¹é€²å¾Œ
```
Research â†’ Markdown â†’ Analyst â†’ Markdown â†’ Report (âœ… æ­£ç¢ºè§£æ) â†’ PDF
                                              â†“
                                         markdown åº«
                                              â†“
                                         BeautifulSoup
                                              â†“
                                         ReportLab
```

### é—œéµé»
- **ä¿æŒ**: Research å’Œ Analyst ä½¿ç”¨ Markdown âœ…
- **ä¿®æ”¹**: Report Agent æ­£ç¢ºè§£æ Markdown âœ…
- **é¿å…**: ä¸éœ€è¦æ”¹æˆå…¨ JSON æµç¨‹ âŒ

---

**åƒè€ƒæ–‡æª”**:
- `MARKDOWN_PDF_åˆ†æå ±å‘Š.md` - å®Œæ•´åˆ†æ
- `æ¶æ§‹åˆ†æåœ–.txt` - è¦–è¦ºåŒ–æ¶æ§‹åœ–
- `agents/report_agent.py` - éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶
