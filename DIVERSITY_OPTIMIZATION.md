# 新聞來源多樣性優化方案

## 📋 問題描述

手動測試發現新聞結果主要來自 **Fintech Singapore** 網站，缺乏來源多樣性。

## 🔍 問題原因

1. **搜尋引擎偏好**: DuckDuckGo 對某些網站的索引更完整
2. **AI 搜尋策略**: 使用 OR 組合多個 site: 時，搜尋引擎會優先返回某些高權重網站
3. **提早停止**: AI 在找到足夠數量的結果後可能停止搜尋其他來源

## ✅ 解決方案

### 方案一：程式碼調整（已實施）

#### 1. 強化 Prompt 中的多樣性要求

在 `research_agent.py` 的 `search()` 方法中：

**調整前**:
- 使用 OR 組合多個網站: `"(site:a.com OR site:b.com OR site:c.com) query"`
- 沒有明確的多樣性要求

**調整後**:
- **分區域獨立搜尋**: 對每個區域的網站進行獨立搜尋
- **明確數量限制**: 禁止超過 40% 的新聞來自同一網站
- **最少來源要求**: 必須使用至少 4-5 個不同來源

**新策略**:
```
a) 越南區域 (2-3 個網站):
   - site:viet-jo.com {query}
   - site:vnexpress.net {query}
   - site:cafef.vn {query}

b) 泰國區域 (1-2 個網站):
   - site:bangkokpost.com {query}
   - site:techsauce.co {query}

c) 新加坡/區域媒體 (2-3 個網站):
   - site:fintechnews.sg {query}
   - site:techinasia.com {query}
   - site:dealstreetasia.com {query}
```

#### 2. 更新 Agent 初始化指令

在 `__init__()` 方法中加入：
- **多樣性要求**: 至少使用 4-5 個不同來源
- **禁止條款**: 不得超過 40% 來自同一網站
- **分區域策略**: 對不同區域分別搜尋

### 方案二：用戶 Prompt 調整（建議補充）

#### 基本用法（無需改變）
```
請搜尋關於「泰國數位支付」的新聞
時間：最近 30 天內
數量：8-10 篇
語言：English
```

#### 進階用法（強化多樣性）
```
請搜尋關於「泰國數位支付」的新聞
時間：最近 30 天內
數量：8-10 篇
語言：English
特別要求：請確保新聞來源多樣化，涵蓋越南、泰國、新加坡等不同區域的媒體
```

## 📊 預期效果

### 調整前
- ❌ 80% 來自 Fintech Singapore
- ❌ 只使用 2-3 個新聞來源
- ❌ 缺乏區域平衡

### 調整後
- ✅ 單一來源不超過 40%
- ✅ 使用 4-5 個或以上不同來源
- ✅ 涵蓋越南、泰國、新加坡等多個區域

## 🧪 測試方法

### 1. 運行多樣性測試腳本
```bash
python test_diversity.py
```

此腳本會：
- 測試多個不同主題的查詢
- 分析每個查詢的來源分布
- 計算多樣性得分（0-100%）
- 顯示詳細的來源統計

### 2. 查看測試結果

**良好的多樣性指標**:
- 多樣性得分 > 50%（使用 9+ 個不同來源）
- 單一來源占比 < 40%
- 涵蓋至少 3 個不同區域

**需改進的指標**:
- 多樣性得分 < 30%（使用 < 6 個不同來源）
- 單一來源占比 > 60%
- 只涵蓋 1-2 個區域

## 🎯 進一步優化建議

### 如果多樣性仍然不足

#### 選項 1: 調整 prompt 權重
在用戶輸入中明確要求：
```
請特別注意：
1. 至少從 5 個不同網站收集新聞
2. 越南、泰國、新加坡的網站都要涵蓋
3. 不要讓單一網站超過 3 篇
```

#### 選項 2: 程式碼後處理
在 `research_agent.py` 的 `search()` 方法中，添加結果過濾邏輯：

```python
# 檢查來源多樣性
source_count = {}
for article in articles:
    domain = extract_domain(article['url'])
    source_count[domain] = source_count.get(domain, 0) + 1

# 如果單一來源超過 40%，觸發警告或重新搜尋
max_percentage = max(source_count.values()) / len(articles) * 100
if max_percentage > 40:
    print(f"⚠️ 來源多樣性不足，{max_percentage:.1f}% 來自單一網站")
```

#### 選項 3: 改用其他搜尋工具
- Google Custom Search API (付費，但結果更多樣)
- RSS Feed 訂閱 (直接從各網站獲取)
- 混合策略 (DuckDuckGo + RSS)

## 📝 實施檢查清單

- [x] 更新 `research_agent.py` 的搜尋策略
- [x] 加入分區域獨立搜尋指令
- [x] 添加多樣性限制要求
- [x] 更新 Agent 初始化指令
- [ ] 運行 `test_diversity.py` 驗證效果
- [ ] 根據測試結果調整參數
- [ ] 更新用戶文檔說明多樣性策略
- [ ] 考慮是否需要程式碼後處理過濾

## 💡 最佳實踐

### 對於用戶
- 在 prompt 中明確提到需要「多樣化來源」
- 如果特別關注某個國家，可以指定「重點關注越南和泰國的媒體」
- 可以要求「每個國家至少一篇新聞」

### 對於開發者
- 定期運行多樣性測試確保效果
- 監控哪些網站經常被使用、哪些較少
- 考慮根據實際使用情況調整18個網站列表
- 如果某些網站從未被使用，考慮替換為更活躍的網站

## 🔄 持續改進

建議每週檢查：
1. 各網站的使用頻率
2. 多樣性得分趨勢
3. 用戶反饋

根據數據調整：
- Prompt 的強調程度
- 區域搜尋順序
- 可信網站列表
